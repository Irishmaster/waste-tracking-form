<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waste Tracking Form</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/4.0.0/signature_pad.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f4f4f4;
        }
        .form-container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        input, button, canvas {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        label {
            font-weight: bold;
        }
        .readonly-field {
            background-color: #e9ecef;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <h2>Waste Tracking Form</h2>
        <form id="wasteForm">
            <!-- Static Fields (Non-editable) -->
            <label for="name">Name (PC Number):</label>
            <input type="text" id="name" name="name" value="PC 0001" class="readonly-field" readonly><br><br>

            <label for="wasteType">Type of Waste:</label>
            <input type="text" id="wasteType" name="wasteType" value="General Waste" class="readonly-field" readonly><br><br>

            <label for="currentLocation">Current Location:</label>
            <input type="text" id="currentLocation" name="currentLocation" placeholder="Fetching location..." class="readonly-field" readonly><br><br>

            <label for="weight">Weight:</label>
            <input type="number" id="weight" name="weight" placeholder="Enter weight" required><br><br>

            <!-- Signature Pad -->
            <label for="signature">Signature (Incharge):</label><br>
            <canvas id="signaturePad" width="300" height="150"></canvas><br><br>
            <button type="button" onclick="clearSignature()">Clear Signature</button><br><br>

            <label for="disposalPlace">Disposal Place:</label>
            <input type="text" id="disposalPlace" name="disposalPlace" value="https://maps.app.goo.gl/cXU78vuF98VgiHA16" class="readonly-field" readonly>
            <button type="button" onclick="openGoogleMaps()">Open in GMaps</button><br><br>

            <label for="finalWeight">Final Weight Check:</label>
            <input type="number" id="finalWeight" name="finalWeight" placeholder="Enter final weight" required><br><br>

            <button type="submit">Submit Task</button>
        </form>
    </div>

    <!-- Signature Pad Script -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/4.0.0/signature_pad.min.js"></script>
    <script>
        // Initialize signature pad
        const signaturePad = new SignaturePad(document.getElementById('signaturePad'));

        // Clear the signature
        function clearSignature() {
            signaturePad.clear();
        }

        // Open Google Maps with the pre-set disposal place
        function openGoogleMaps() {
            const disposalPlace = document.getElementById('disposalPlace').value;
            window.open(disposalPlace, '_blank');
        }

        // Fetch current location automatically when the page is loaded
        function fetchLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    const currentLocation = `Latitude: ${latitude}, Longitude: ${longitude}`;
                    document.getElementById('currentLocation').value = currentLocation;
                });
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }

        // Handle form submission
        document.getElementById("wasteForm").onsubmit = function(event) {
            event.preventDefault();

            // Get all form data
            const formData = new FormData(event.target);
            const signature = signaturePad.toDataURL();

            // Combine the form data and signature image
            const data = {
                name: formData.get('name'),
                wasteType: formData.get('wasteType'),
                currentLocation: formData.get('currentLocation'),
                weight: formData.get('weight'),
                signature: signature,
                disposalPlace: formData.get('disposalPlace'),
                finalWeight: formData.get('finalWeight')
            };

            console.log("Form Submitted: ", data);
            alert("Task Submitted Successfully!");

            // Optionally, send the data to a server (e.g., Firebase, Node.js, etc.)
        };

        // Fetch location on page load
        window.onload = fetchLocation;
    </script>
</body>
</html>
